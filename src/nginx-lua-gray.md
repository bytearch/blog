#### 基于nginx+lua实现按流量灰度方案

##### 1. 为什么要灰度方案

​	灰度方案主要用于老系统向新系统迁移时过度方案, 如果有问题,可以立马回滚到老系统,降级风险.当然要保证可以新老切换，得首先保障数据库层面是完全一样的(所以也就有了新老系统数据双向同步,这个后面会详细讲到)。其次,按流量灰度比如前期我们新系统只放万分之一的量,有问题也是影响及少量用户(事实证明,重构没有一帆风顺的,多多少少会有想不到的问题发生),所以灰度方案极其重要。